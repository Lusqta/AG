{% extends 'sales/base.html' %}

{% block content %}
<div class="header">
    <h2 style="font-size: 1.75rem; font-weight: 700;">Clientes</h2>
    <a href="{% url 'add_customer' %}" class="btn btn-primary">+ Adicionar Cliente</a>
</div>

<div class="card" style="margin-bottom: 1.5rem;">
    <form method="get" style="display: flex; gap: 1rem;">
        <input type="text" name="q" value="{{ query }}" placeholder="Buscar por nome, email ou telefone..."
            style="flex: 1; padding: 0.6rem; border: 1px solid #e2e8f0; border-radius: 6px;">
        <button type="submit" class="btn btn-primary">Buscar</button>
        {% if query %}
        <a href="{% url 'customer_list' %}" class="btn btn-secondary">Limpar</a>
        {% endif %}
    </form>
</div>

<div class="card">
    <div class="table-container">
        <table>
            <thead>
                <tr>
                    <th>Nome</th>
                    <th>E-mail</th>
                    <th>Telefone</th>
                    <th>Status</th>
                    <th>Atribuído a</th>
                    <th>Ações</th>
                </tr>
            </thead>
            <tbody>
                {% for customer in customers %}
                <tr class="clickable-row" data-href="{% url 'customer_detail' customer.pk %}" style="cursor: pointer;">
                    <td style="font-weight: 600;">{{ customer.first_name }} {{ customer.last_name }}</td>
                    <td>{{ customer.email }}</td>
                    <td>{{ customer.phone }}</td>
                    <td><span class="badge badge-{{ customer.status }}">{{ customer.get_status_display }}</span></td>
                    <td>{{ customer.assigned_to.get_full_name|default:customer.assigned_to.username|default:"-" }}</td>
                    <td>
                        <a href="{% url 'customer_detail' customer.pk %}" style="color: var(--secondary-color);">Ver</a>
                    </td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="6" style="text-align: center; padding: 2rem;">Nenhum cliente encontrado.</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

{% if customers.paginator.num_pages > 1 %}
<div class="pagination">
    {% if customers.has_previous %}
    <a href="?page={{ customers.previous_page_number }}{% if query %}&q={{ query }}{% endif %}"
        class="btn-pagination"><i class="fas fa-chevron-left"></i> Anterior</a>
    {% endif %}

    <span class="pagination-info">
        Página {{ customers.number }} de {{ customers.paginator.num_pages }}
    </span>

    {% if customers.has_next %}
    <a href="?page={{ customers.next_page_number }}{% if query %}&q={{ query }}{% endif %}"
        class="btn-pagination">Próxima <i class="fas fa-chevron-right"></i></a>
    {% endif %}
</div>
{% endif %}
</div>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        const rows = document.querySelectorAll(".clickable-row");
        rows.forEach(row => {
            row.addEventListener("click", () => {
                window.location.href = row.dataset.href;
            });
        });
    });
</script>
{% endblock %}