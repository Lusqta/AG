{% extends 'sales/base.html' %}

{% load humanize %}
{% block content %}
<div class="header">
    <h2 style="font-size: 1.75rem; font-weight: 700;">Inventário</h2>
    <a href="{% url 'add_vehicle' %}" class="btn btn-primary">+ Adicionar Veículo</a>
</div>

<div class="card" style="margin-bottom: 1.5rem;">
    <form method="get" style="display: flex; gap: 1rem;">
        <input type="text" name="q" value="{{ query }}" placeholder="Buscar por marca, modelo ou VIN..."
            style="flex: 1; padding: 0.6rem; border: 1px solid #e2e8f0; border-radius: 6px;">
        <button type="submit" class="btn btn-primary">Buscar</button>
        {% if query %}
        <a href="{% url 'vehicle_list' %}" class="btn btn-secondary">Limpar</a>
        {% endif %}
    </form>
</div>

<div class="card" style="background: transparent; box-shadow: none; padding: 0;">
    <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 1.5rem;">
        {% for vehicle in vehicles %}
        <div class="card" style="margin-bottom: 0; display: flex; flex-direction: column;">
            {% if vehicle.image %}
            <div
                style="height: 200px; background-image: url('{{ vehicle.image.url }}'); background-size: cover; background-position: center; border-radius: 8px; margin-bottom: 1rem;">
            </div>
            {% elif vehicle.image_url %}
            <div
                style="height: 200px; background-image: url('{{ vehicle.image_url }}'); background-size: cover; background-position: center; border-radius: 8px; margin-bottom: 1rem;">
            </div>
            {% else %}
            <div
                style="height: 200px; background-color: #f1f5f9; border-radius: 8px; margin-bottom: 1rem; display: flex; align-items: center; justify-content: center; color: #94a3b8;">
                <i class="fas fa-car" style="font-size: 3rem;"></i>
            </div>
            {% endif %}

            <div style="margin-bottom: auto;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
                    <span class="badge badge-{{ vehicle.status }}">{{vehicle.get_status_display}}</span>
                    <span style="font-weight: 700; font-size: 1.1rem;">R$ {{ vehicle.price|intcomma }}</span>
                </div>
                <h3 style="font-size: 1.25rem; margin-bottom: 0.25rem;">{{vehicle.year}} {{vehicle.make}}
                    {{vehicle.model}}</h3>
                <p style="color: #64748b; font-size: 0.9rem;">{{vehicle.mileage}} km • {{vehicle.color}}</p>
                {% if vehicle.license_plate %}
                <p style="color: #64748b; font-size: 0.9rem; margin-top: 0.2rem;">Placa:
                    <strong>{{vehicle.license_plate}}</strong></p>
                {% endif %}
            </div>

            <div
                style="margin-top: 1rem; border-top: 1px solid #e2e8f0; padding-top: 1rem; display: flex; gap: 0.5rem;">
                {% if vehicle.status == 'available' %}
                <a href="{% url 'create_sale' %}?vehicle={{ vehicle.id }}" class="btn btn-primary"
                    style="flex: 2; text-align: center; padding: 0.5rem;">Vender</a>
                {% endif %}
                <a href="{% url 'edit_vehicle' vehicle.id %}" class="btn btn-secondary"
                    style="flex: 1; text-align: center; padding: 0.5rem;" title="Editar"><i class="fas fa-edit"></i></a>
                {% if can_delete %}
                <a href="{% url 'delete_vehicle' vehicle.id %}" class="btn"
                    style="flex: 1; text-align: center; padding: 0.5rem; background-color: #fee2e2; color: #991b1b;"
                    title="Excluir"><i class="fas fa-trash"></i></a>
                {% endif %}
            </div>
        </div>
        {% empty %}
        <div style="grid-column: 1 / -1; text-align: center; padding: 3rem;">
            Nenhum veículo encontrado no inventário.
        </div>
        {% endfor %}
    </div>
</div>

{% if vehicles.paginator.num_pages > 1 %}
<div class="pagination">
    {% if vehicles.has_previous %}
    <a href="?page={{ vehicles.previous_page_number }}{% if query %}&q={{ query }}{% endif %}" class="btn-pagination"><i
            class="fas fa-chevron-left"></i> Anterior</a>
    {% endif %}

    <span class="pagination-info">
        Página {{ vehicles.number }} de {{ vehicles.paginator.num_pages }}
    </span>

    {% if vehicles.has_next %}
    <a href="?page={{ vehicles.next_page_number }}{% if query %}&q={{ query }}{% endif %}"
        class="btn-pagination">Próxima <i class="fas fa-chevron-right"></i></a>
    {% endif %}
</div>
{% endif %}
{% endblock %}